quests:
  - id: "01_awakening"
    title: "MODULE 01: THE AWAKENING"
    chapters:
      # --- CHAPTER 1: ORIENTATION ---
      - title: "Orientation"
        intro: |
          [Welcome to SuperShell]

          For years, you have interacted with computers through a veil.
          You were a guest in your own house. That ends now.

          You have stripped away the Graphical User Interface.
          Here, you do not point. You do not click.
          You speak, and the machine obeys.

          First, we must establish your senses in the dark.

        setup_actions:
          - type: RemovePath
            path: "workspace"

        outro: |
          Vision returned. Coordinates locked.
          You have successfully mapped your immediate surroundings.

        tasks:
          - description: "Enter the Construct"
            instruction: "Our operations are contained within the 'Construct' directory. Move there now."
            objective: "cd ~/Construct"
            success_msg: "Construct Environment Accessed."
            conditions:
              - type: WorkingDir
                path: "Construct$"

          - description: "Ping the sonar."
            instruction: "The screen is dark. You must actively ask the system to describe itself."
            objective: "Type 'ls' to list contents."
            success_msg: "Vision returned. The system has revealed its contents."
            conditions:
              - type: CommandMatches
                pattern: "^ls"

          - description: "Triangulate position."
            instruction: |
              Scanning tells you WHAT is nearby, but not WHERE you are.
              Linux is an 'Upside-Down Tree'. You are currently on a branch.
            objective: "Type 'pwd' to print working directory."
            success_msg: "Coordinates locked. You are grounded."
            conditions:
              - type: CommandMatches
                pattern: "^pwd"

          - description: "Identify the Root."
            instruction: |
              Your path likely starts with '/'. This is the Root.
              Every file grows downward from this single point.
              Let us look at the source.
            objective: "Type 'ls /' to list the root directory."
            success_msg: "The Foundation revealed."
            conditions:
              - type: CommandMatches
                pattern: "^ls\\s+/"

          - description: "Scan the Home Branch."
            instruction: |
              We can look at other branches without moving.
              Let's look at the 'home' branch inside of the root.
            objective: "Type 'ls /home'"
            success_msg: "Remote scan complete."
            conditions:
              - type: CommandMatches
                pattern: "^ls.*/home"

      # --- CHAPTER 2: MANIPULATION ---
      - title: "Manifestation"
        intro: |
          [PHASE 2: INTERACTION]

          Now that you know the shape of the world, we can alter it.
          There is no "Right Click -> New Folder" here.

          If you want structure, you must speak it into existence.
        outro: |
          Structure verified.
          You have proven you can alter the digital landscape.
        tasks:
          - description: "Construct a directory."
            instruction: "Command the system to make a directory named 'workspace'."
            objective: "Type 'mkdir workspace'"
            success_msg: "It is done. Structure created."
            conditions:
              # Rust now checks ~/Construct/workspace automatically
              - type: IsDirectory
                path: "workspace"

          - description: "Shift focus."
            instruction: |
              The directory exists, but you are outside it.
              Movement in the Shell is not physical; it is a shift in focus.
              Use a 'Relative Path'.
            objective: "Type 'cd workspace'"
            success_msg: "Focus shifted. You are inside the construct."
            conditions:
              - type: WorkingDir
                path: "workspace$"

          - description: "Verify the void."
            instruction: |
              In the GUI, an empty folder is a white box.
              Here, it is simply silence. If the system says nothing, there is nothing.
            objective: "Type 'ls' to verify it is empty."
            success_msg: "Silence confirmed."
            conditions:
              - type: CommandMatches
                pattern: "^ls"

      # --- CHAPTER 3: RESTORATION ---
      - title: "Restoration"
        intro: |
          [PHASE 3: RETREAT]

          A master operator leaves no trace.
          We must return to the surface and remove our temporary constructs.
        outro: |
          [PROFICIENCY LOGGED]

          You have taken your first steps without a visual guide.
          The silence of the terminal is no longer a void; it is a waiting room.

          You are ready to begin building.
        tasks:
          - description: "Return to surface."
            instruction: |
              We must return to the parent level.
              The '..' (dot dot) link points to the branch above you.
            objective: "Type 'cd ..'"
            success_msg: "Returned to home. Path integration complete."
            conditions:
              - type: WorkingDir
                path: "Construct$"

          - description: "Remove the construct."
            instruction: |
              We need to remove the 'workspace' directory.
              Use 'rmdir' (Remove Directory).
            objective: "Type 'rmdir workspace'"
            success_msg: "Trace removed. System clean."
            conditions:
              # Rust checks ~/Construct/workspace
              - type: PathMissing
                path: "workspace"
