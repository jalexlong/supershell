quests:
  - id: "02_archive"
    title: "MODULE 02: THE ARCHIVE"
    construct: true
    chapters:
      # --- CHAPTER 1: RETRIEVAL ---
      - title: "The Signal"
        intro: |
          [ARCHIVE CONNECTION ESTABLISHED]

          We have detected a faint signal within the Construct.
          A file has materialized, but its contents are hidden.

          To proceed, you must learn to read.

        setup_actions:
          - type: CreateFile
            path: "signal.txt"
            content: "SECURITY_CODE: 8842"

        outro: |
          Signal decoded.
          You have successfully retrieved information from a static file.
          The first barrier is down.

        tasks:
          # TASK 1: Read
          - description: "Read the file."
            instruction: "The file is named 'signal.txt'. Use 'cat' (Concatenate) to read it."
            objective: "Type 'cat signal.txt'"
            hint: "'cat' prints the text inside a file to your screen. Try: cat signal.txt"
            success_msg: "File read. You see the code '8842'."
            conditions:
              - type: CommandMatches
                pattern: "^cat\\s+signal\\.txt"
              - type: WorkingDir
                path: "Construct$"

          # TASK 2: Submit
          - description: "Submit the code."
            instruction: "The system awaits the security code found in the file."
            objective: "Type 'echo 8842'"
            hint: "To 'submit' data in this terminal, we echo it back. Type: echo 8842"
            success_msg: "Code verified. Access granted."
            conditions:
              - type: CommandMatches
                pattern: "^echo\\s+8842"

      # --- CHAPTER 2: THE MAZE ---
      - title: "The Labyrinth"
        intro: |
          [ACCESS LEVEL 2 GRANTED]

          The Archive is not a flat surface. It is deep.
          We have located a Data Shard buried beneath layers of old directories.

          You must navigate the maze to find it.

        # NOTE: Verify indentation here carefully
        setup_actions:
          - type: RemovePath
            path: "signal.txt"
          - type: CreateDir
            path: "Vault"
          - type: CreateDir
            path: "Vault/Level_01"
          - type: CreateDir
            path: "Vault/Level_01/Sector_7"
          - type: CreateFile
            path: "Vault/Level_01/Sector_7/shard.dat"
            content: "ANCIENT_DATA_PACKET"

        outro: |
          Target acquired.
          You have successfully navigated the deep structure.
          However, the data is useless down here. We must bring it to the surface.

        tasks:
          - description: "Enter the Vault."
            instruction: "Navigate into the 'Vault' directory."
            objective: "cd Vault"
            hint: "Use 'ls' to see the folder, then 'cd Vault' to enter it."
            success_msg: "Entered the Vault."
            conditions:
              - type: WorkingDir
                path: "Vault$"

          - description: "Descend deeper."
            instruction: "Go deeper. Enter 'Level_01'."
            objective: "cd Level_01"
            hint: "Type 'cd Level_01'"
            success_msg: "Depth increased."
            conditions:
              - type: WorkingDir
                path: "Level_01$"

          - description: "Locate the Shard."
            instruction: "The scanner points to 'Sector_7'. Move there."
            objective: "cd Sector_7"
            hint: "Type 'cd Sector_7'"
            success_msg: "Shard located."
            conditions:
              - type: WorkingDir
                path: "Sector_7$"

          - description: "Verify the asset."
            instruction: "Confirm the 'shard.dat' file is here."
            objective: "ls"
            hint: "Type 'ls' to list the files in this deep sector."
            success_msg: "Asset confirmed."
            conditions:
              - type: CommandMatches
                pattern: "^ls"

      # --- CHAPTER 3: EXTRACTION ---
      - title: "Extraction"
        intro: |
          [ASSET SECURED]

          Finding the data is not enough. We must bring it to the surface.
          You are deep in the structure: ~/Construct/Vault/Level_01/Sector_7

          We need the file at: ~/Construct
        outro: |
          [ARCHIVE SYNC COMPLETE]

          You have learned to read signals, navigate deep structures, and relocate data.
          The Archive is now open to you.
        tasks:
          - description: "Extract the Shard."
            instruction: |
              Move 'shard.dat' to your home construct.
              The path to home is three levels up: ../../../
            objective: "Type 'mv shard.dat ../../../'"
            hint: "'mv' moves files. Syntax: mv [WHAT] [WHERE]. The 'where' is 3 levels up: ../../../"
            success_msg: "Asset extracted to root."
            conditions:
              - type: IsFile
                path: "shard.dat"

          - description: "Return to surface."
            instruction: "Leave the maze. Return to the Construct root."
            objective: "cd ../../../"
            hint: "You can jump multiple levels at once. Type: cd ../../../"
            success_msg: "Surface reached."
            conditions:
              - type: WorkingDir
                path: "Construct$"

          - description: "Cleanup."
            instruction: "Destroy the empty Vault. It is no longer needed."
            objective: "Type 'rm -r Vault'"
            hint: "'rm -r' removes a directory and everything inside it recursively."
            success_msg: "Tracks covered."
            conditions:
              - type: PathMissing
                path: "Vault"
